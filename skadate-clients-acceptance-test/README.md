# Функциональные тесты  для клиентов skdate


Установка
---------

1. В корень вашего веб сервера скачивается и настраиваеться  образ сайта клиента (в результате мы должны иметь возможность запустить сайт через бразуер, если в образе имеется еще и файрберд то его также следует установить и настроить на использование данного образа)
1. Затем в скаченный образ сайта в корень скачиваются тесты - **https://github.com/skalfa/skadate-clients-acceptance-test/archive/master.zip** ( ПОСЛЕ распаковки уберите слово master)
1. Нужно зайти в директорию с тестами **skadate-clients-acceptance-test** и запустить комманду установки **./install.sh**


Тестирование
------------

1. Перед запуском тестов нужно зайти в директорию с тестами **skadate-clients-acceptance-test** и запустить окружение: **bin/selenium.sh** 
1. Все тесты находятся в папке - **features**  и по умолчанию они все отключены т.е нужно выбрать те тесты которые больше всего подходят клиенту и пометить их тегом **@work** к примеру: **@work Scenario: Sending chat messages on the profile view page**
1. Для запуска тестов нужно выполнить комманду: **bin/behat --suite="desktop" --tags "@work"** запуск тестов только для скайдейт или **bin/behat --suite="firebird" --tags "@work"** запуск тестов файрберд
1. Если часть тестов упала то нужно их починить прежде чем их заливать в репозиторий клиента (т.е в базовой поставке у нас есть примеры тестов но никто не гарантирует, что они будут работать у каждого клиента все это зависит от настроек самого сайта)
1. Если вам нужно прогнать тесты на живом тестовом сайте клиента сначал разверните его как описано здесь (https://github.com/skalfa/workflow/wiki/department_scripts) затем запустите тесты с помощью комманд: **bin/behat --suite="desktop_live" --tags "@work"** запуск тестов только для скайдейт или **bin/behat --suite="firebird_live" --tags "@work"** запуск тестов файрберд
(Перед запуском тестов нужно в конфиг ***behat.yml** указать адрес живого сайта)

Окончание тестирования
----------------------

После того как написаны новые или адаптированы старые тесты вам нужно:

1. В корень слепка со **skadate** нужно еще скопировать файл **.travis.skadate.firebird.yml** или **.travis.skadate.yml** (Если у клиента только skadate и нету firebird) из директории **skadate-clients-acceptance-test/configs**
1. Переименовать файл в корне в **.travis.yml**
1. Если вы делали какие то специальные настройки на слепке клиента в базе данных к примеру устанавливали плагины то вам нужно по новой снять ваш локальный дамп базы данных и заменить им старый (можете воспользоваться скриптом mario - https://github.com/skalfa/mario).
Это нужно, чтобы CI сервер тестировал на полностью настроенном окружении 
1. Подлить как есть директорию с тестами в клиентский репозиторий и ранее добавленный файл **.travis.yml** (git push)

После этого нужно зайти в репозиторий клиента и убедиться что тесты проходят нормально без ошибок


Дополнительный материал
-----------------------

1. (Как работать с DOM страниц) http://mink.behat.org/en/latest/guides/traversing-pages.html
1. (Манипулирование страницами) http://mink.behat.org/en/latest/guides/manipulating-pages.html
1. (Интерактив со страницами) http://mink.behat.org/en/latest/guides/interacting-with-pages.html
1. При падении тестов скриншоты и логи можно найти по ссылке - https://s3.amazonaws.com/ci-logs-skadate/list.html **(формат директорий git-user/repo-name/build)**